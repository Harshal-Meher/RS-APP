<!-- update-register-user.component.html -->
<div class="edit-user-form p-4" style="max-width: 600px; margin: auto; height: 700px; overflow-y: auto;">
  <form [formGroup]="updateUserForm" (ngSubmit)="updateUser()">
      <h2 class="mb-4">Update User Profile</h2>

      <!-- Personal Information -->
      <div class="section mb-4">
          <h3>Personal Information</h3>
          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>First Name</mat-label>
              <input matInput type="text" formControlName="firstname" required>
              <mat-error *ngIf="updateUserForm.get('firstname')?.hasError('required') && updateUserForm.get('firstname')?.touched">
                  First name is required
              </mat-error>
              <mat-error *ngIf="updateUserForm.get('firstname')?.hasError('minlength') && updateUserForm.get('firstname')?.touched">
                  Minimum 2 characters required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Last Name</mat-label>
              <input matInput type="text" formControlName="lastname" required>
              <mat-error *ngIf="updateUserForm.get('lastname')?.hasError('required') && updateUserForm.get('lastname')?.touched">
                  Last name is required
              </mat-error>
              <mat-error *ngIf="updateUserForm.get('lastname')?.hasError('minlength') && updateUserForm.get('lastname')?.touched">
                  Minimum 2 characters required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" required>
              <mat-error *ngIf="updateUserForm.get('email')?.hasError('required') && updateUserForm.get('email')?.touched">
                  Email is required
              </mat-error>
              <mat-error *ngIf="updateUserForm.get('email')?.hasError('email') && updateUserForm.get('email')?.touched">
                  Please enter a valid email address
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Mobile</mat-label>
              <input matInput type="tel" formControlName="mobile" required>
              <mat-error *ngIf="updateUserForm.get('mobile')?.hasError('required') && updateUserForm.get('mobile')?.touched">
                  Mobile number is required
              </mat-error>
              <mat-error *ngIf="updateUserForm.get('mobile')?.hasError('pattern') && updateUserForm.get('mobile')?.touched">
                  Please enter a valid 10-digit mobile number
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Gender</mat-label>
              <mat-select formControlName="gender" required>
                  <mat-option value="male">Male</mat-option>
                  <mat-option value="female">Female</mat-option>
                  <mat-option value="other">Other</mat-option>
              </mat-select>
              <mat-error *ngIf="updateUserForm.get('gender')?.hasError('required') && updateUserForm.get('gender')?.touched">
                  Gender is required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Date of Birth</mat-label>
              <input matInput type="date" formControlName="dob" required>
              <mat-error *ngIf="updateUserForm.get('dob')?.hasError('required') && updateUserForm.get('dob')?.touched">
                  Date of birth is required
              </mat-error>
              <mat-error *ngIf="updateUserForm.get('dob')?.hasError('invalidDate') && updateUserForm.get('dob')?.touched">
                  Date must be in the past
              </mat-error>
          </mat-form-field>
      </div>

      <!-- Address Information -->
      <div class="section mb-4">
          <h3>Address Information</h3>
          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Area</mat-label>
              <input matInput type="text" formControlName="area" required>
              <mat-error *ngIf="updateUserForm.get('area')?.touched && updateUserForm.get('area')?.invalid">
                  Area is required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>City</mat-label>
              <input matInput type="text" formControlName="city" required>
              <mat-error *ngIf="updateUserForm.get('city')?.touched && updateUserForm.get('city')?.invalid">
                  City is required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>State</mat-label>
              <input matInput type="text" formControlName="state" required>
              <mat-error *ngIf="updateUserForm.get('state')?.touched && updateUserForm.get('state')?.invalid">
                  State is required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Country</mat-label>
              <input matInput type="text" formControlName="country" required>
              <mat-error *ngIf="updateUserForm.get('country')?.touched && updateUserForm.get('country')?.invalid">
                  Country is required
              </mat-error>
          </mat-form-field>
      </div>

      <!-- Additional Information -->
      <div class="section mb-4">
          <h3>Additional Information</h3>
          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Branch Name</mat-label>
              <input matInput type="text" formControlName="branchname" required>
              <mat-error *ngIf="updateUserForm.get('branchname')?.touched && updateUserForm.get('branchname')?.invalid">
                  Branch name is required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Batch Time</mat-label>
              <input matInput type="text" formControlName="batchtime" required>
              <mat-error *ngIf="updateUserForm.get('batchtime')?.touched && updateUserForm.get('batchtime')?.invalid">
                  Batch time is required
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Enquiry Detail</mat-label>
              <textarea matInput formControlName="enquirydetail" rows="3" required></textarea>
              <mat-hint>{{updateUserForm.get('enquirydetail')?.value?.length || 0}}/500</mat-hint>
              <mat-error *ngIf="updateUserForm.get('enquirydetail')?.hasError('required') && updateUserForm.get('enquirydetail')?.touched">
                  Enquiry detail is required
              </mat-error>
              <mat-error *ngIf="updateUserForm.get('enquirydetail')?.hasError('maxlength') && updateUserForm.get('enquirydetail')?.touched">
                  Maximum 500 characters allowed
              </mat-error>
          </mat-form-field>
      </div>

      <!-- Password Section -->
      <div class="section mb-4">
          <h3>Security</h3>
          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Password</mat-label>
              <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" required>
              <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
                  <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="updateUserForm.get('password')?.touched && updateUserForm.get('password')?.invalid">
                  Password must be at least 6 characters
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Confirm Password</mat-label>
              <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="confirmpassword" required>
              <mat-error *ngIf="updateUserForm.hasError('mismatch') && updateUserForm.get('confirmpassword')?.touched">
                  Passwords must match
              </mat-error>
          </mat-form-field>
      </div>

      <mat-checkbox formControlName="isActive" class="mb-3">
          Active Status
      </mat-checkbox>

      <div class="d-flex justify-content-end mt-4">
          <button mat-raised-button color="primary" type="submit" 
                [disabled]="updateUserForm.invalid">
              <mat-spinner *ngIf="isLoading" diameter="20" class="d-inline-block"></mat-spinner>
              {{ isLoading ? 'Updating...' : 'Update' }}
          </button>
          <button mat-button color="warn" type="button" (click)="closeModel()" 
                  [disabled]="isLoading" class="ms-2">
              Cancel
          </button>
      </div>
  </form>
</div>